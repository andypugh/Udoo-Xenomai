***************
*** 12,21 ****
  	unsigned long preempt_count = preempt_count();
  	int this_cpu = raw_smp_processor_id();
  
  	if (likely(preempt_count))
  		goto out;
  
- 	if (irqs_disabled())
  		goto out;
  
  	/*
--- 12,24 ----
  	unsigned long preempt_count = preempt_count();
  	int this_cpu = raw_smp_processor_id();
  
+ 	if (!ipipe_root_domain_p)
+ 		goto out;
+ 
  	if (likely(preempt_count))
  		goto out;
  
+ 	if (irqs_disabled() || irqs_disabled_hw())
  		goto out;
  
  	/*
