***************
*** 85,90 ****
  	.macro	enable_irq_notrace
  	cpsie	i
  	.endm
  #else
  	.macro	disable_irq_notrace
  	msr	cpsr_c, #PSR_I_BIT | SVC_MODE
--- 85,102 ----
  	.macro	enable_irq_notrace
  	cpsie	i
  	.endm
+ 
+ 	.macro  disable_irq_cond
+ #ifdef CONFIG_IPIPE
+ 	cpsid	i
+ #endif /* CONFIG_IPIPE */
+ 	.endm
+ 
+ 	.macro  enable_irq_cond
+ #ifdef CONFIG_IPIPE
+ 	cpsie	i
+ #endif /* CONFIG_IPIPE */
+ 	.endm
  #else
  	.macro	disable_irq_notrace
  	msr	cpsr_c, #PSR_I_BIT | SVC_MODE
***************
*** 93,98 ****
  	.macro	enable_irq_notrace
  	msr	cpsr_c, #SVC_MODE
  	.endm
  #endif
  
  	.macro asm_trace_hardirqs_off
--- 105,122 ----
  	.macro	enable_irq_notrace
  	msr	cpsr_c, #SVC_MODE
  	.endm
+ 
+ 	.macro	disable_irq_cond
+ #ifdef CONFIG_IPIPE
+ 	msr	cpsr_c, #PSR_I_BIT | SVC_MODE
+ #endif /* CONFIG_IPIPE */
+ 	.endm
+ 
+ 	.macro	enable_irq_cond
+ #ifdef CONFIG_IPIPE
+ 	msr	cpsr_c, #SVC_MODE
+ #endif /* CONFIG_IPIPE */
+ 	.endm
  #endif
  
  	.macro asm_trace_hardirqs_off
