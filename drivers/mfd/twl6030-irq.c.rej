***************
*** 140,146 ****
  			if (sts.int_sts & 0x1) {
  				int module_irq = twl6030_irq_base +
  					twl6030_interrupt_mapping[i];
  				generic_handle_irq(module_irq);
  
  			}
  		local_irq_enable();
--- 140,153 ----
  			if (sts.int_sts & 0x1) {
  				int module_irq = twl6030_irq_base +
  					twl6030_interrupt_mapping[i];
+ #ifndef CONFIG_IPIPE
  				generic_handle_irq(module_irq);
+ #else
+ 				{
+ 					struct irq_desc *d = irq_to_desc(module_irq);
+ 					d->ipipe_ack(module_irq, d);
+ 				}
+ #endif
  
  			}
  		local_irq_enable();
***************
*** 353,358 ****
  		pr_err("twl6030: could not claim irq%d: %d\n", irq_num, status);
  		goto fail_irq;
  	}
  	return status;
  fail_irq:
  	free_irq(irq_num, &irq_event);
--- 360,366 ----
  		pr_err("twl6030: could not claim irq%d: %d\n", irq_num, status);
  		goto fail_irq;
  	}
+ 
  	return status;
  fail_irq:
  	free_irq(irq_num, &irq_event);
***************
*** 372,375 ****
  	}
  	return 0;
  }
- 
--- 380,382 ----
  	}
  	return 0;
  }
