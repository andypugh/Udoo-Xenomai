***************
*** 23,28 ****
  #include <linux/init.h>
  #include <linux/nmi.h>
  #include <linux/dmi.h>
  
  #define PANIC_TIMER_STEP 100
  #define PANIC_BLINK_SPD 18
--- 23,29 ----
  #include <linux/init.h>
  #include <linux/nmi.h>
  #include <linux/dmi.h>
+ #include <linux/ipipe_trace.h>
  
  #define PANIC_TIMER_STEP 100
  #define PANIC_BLINK_SPD 18
***************
*** 327,332 ****
  {
  	tracing_off();
  	/* can't trust the integrity of the kernel anymore: */
  	debug_locks_off();
  	do_oops_enter_exit();
  }
--- 328,335 ----
  {
  	tracing_off();
  	/* can't trust the integrity of the kernel anymore: */
+ 	ipipe_trace_panic_freeze();
+ 	ipipe_disable_context_check(ipipe_processor_id());
  	debug_locks_off();
  	do_oops_enter_exit();
  }
