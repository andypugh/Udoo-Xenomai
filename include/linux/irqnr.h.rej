***************
*** 24,30 ****
  #else /* CONFIG_GENERIC_HARDIRQS */
  
  extern int nr_irqs;
  extern struct irq_desc *irq_to_desc(unsigned int irq);
  unsigned int irq_get_next_irq(unsigned int offset);
  
  # define for_each_irq_desc(irq, desc)					\
--- 24,34 ----
  #else /* CONFIG_GENERIC_HARDIRQS */
  
  extern int nr_irqs;
+ #if !defined(CONFIG_IPIPE) || defined(CONFIG_SPARSE_IRQ)
  extern struct irq_desc *irq_to_desc(unsigned int irq);
+ #else
+ #define irq_to_desc(irq)	(&irq_desc[irq])
+ #endif
  unsigned int irq_get_next_irq(unsigned int offset);
  
  # define for_each_irq_desc(irq, desc)					\
