***************
*** 210,215 ****
  
  #define nmi_enter()						\
  	do {							\
  		ftrace_nmi_enter();				\
  		BUG_ON(in_nmi());				\
  		add_preempt_count(NMI_OFFSET + HARDIRQ_OFFSET);	\
--- 210,216 ----
  
  #define nmi_enter()						\
  	do {							\
+ 		ipipe_nmi_enter();				\
  		ftrace_nmi_enter();				\
  		BUG_ON(in_nmi());				\
  		add_preempt_count(NMI_OFFSET + HARDIRQ_OFFSET);	\
***************
*** 226,231 ****
  		BUG_ON(!in_nmi());				\
  		sub_preempt_count(NMI_OFFSET + HARDIRQ_OFFSET);	\
  		ftrace_nmi_exit();				\
  	} while (0)
  
  #endif /* LINUX_HARDIRQ_H */
--- 227,233 ----
  		BUG_ON(!in_nmi());				\
  		sub_preempt_count(NMI_OFFSET + HARDIRQ_OFFSET);	\
  		ftrace_nmi_exit();				\
+ 		ipipe_nmi_exit();				\
  	} while (0)
  
  #endif /* LINUX_HARDIRQ_H */
